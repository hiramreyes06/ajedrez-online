(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{DT6l:function(a,i,t){"use strict";t.r(i),t.d(i,"EspectadorModule",function(){return C});var e=t("ofXK"),s=t("mrSG"),n=t("tyNb"),o=t("quSY"),r=t("ffzF"),c=t("wOSr"),d=t("iELJ"),l=t("fXoL"),p=t("jU0p"),h=t("Dxy4");let m=(()=>{class a{constructor(a,i,t){this.resultado=a,this.dialogRef=i,this.socketService=t}ngOnInit(){}mensajeStatus(){return this.socketService.roomConectado?"Espera a que los jugadores jueguen una revancha":"Busca otra de las partidas en linea"}}return a.\u0275fac=function(i){return new(i||a)(l.Lb(d.a),l.Lb(d.e),l.Lb(p.a))},a.\u0275cmp=l.Fb({type:a,selectors:[["app-fin-partida"]],decls:6,vars:2,consts:[[2,"font-weight","bold","text-align","center"],["mat-raised-button","",1,"btnAzul",2,"display","block","margin-left","auto","margin-right","auto","margin-top","5px",3,"click"]],template:function(a,i){1&a&&(l.Rb(0,"p",0),l.yc(1),l.Qb(),l.Rb(2,"p",0),l.yc(3),l.Qb(),l.Rb(4,"button",1),l.Yb("click",function(){return i.dialogRef.close(!0)}),l.yc(5," Partidas en vivo\n"),l.Qb()),2&a&&(l.Ab(1),l.zc(i.resultado),l.Ab(2),l.zc(i.mensajeStatus()))},directives:[h.a],styles:[".mat-dialog-container{padding:8px!important;background-color:#8ab9b5!important}"]}),a})();var u=t("AytR"),g=t("5YT4"),b=t("pLZG"),I=t("jDhr"),O=t("IheW"),P=t("jMqV"),E=t("Wp6s");const v=["perspectiva"];function f(a,i){if(1&a&&(l.Rb(0,"p",7),l.yc(1),l.Qb()),2&a){const a=l.cc();l.Ab(1),l.Ac(" ",a.infoJugador(!0)," aproximado ")}}function z(a,i){if(1&a&&(l.Rb(0,"p",9),l.yc(1),l.Qb()),2&a){const a=l.cc().$implicit,i=l.cc().$implicit,t=l.cc();l.Ab(1),l.Ac(" ",t.getUnicode(t.casillas[t.getIndexByXY(a,i)])," ")}}function x(a,i){if(1&a&&(l.Rb(0,"td"),l.xc(1,z,2,1,"p",8),l.Qb()),2&a){const a=i.$implicit,t=l.cc().$implicit,e=l.cc();l.Ab(1),l.ic("ngIf",null!=e.casillas[e.getIndexByXY(a,t)])}}function A(a,i){if(1&a&&(l.Rb(0,"tr"),l.xc(1,x,2,1,"td",4),l.Qb()),2&a){const a=l.cc();l.Ab(1),l.ic("ngForOf",a.orientacionColumns)}}function N(a,i){if(1&a&&(l.Rb(0,"p",7),l.yc(1),l.Qb()),2&a){const a=l.cc();l.Ab(1),l.Ac("",a.infoJugador(!1)," aproximado")}}let R=(()=>{class a{constructor(a,i,t,e,s,n){this.rout=a,this.socketService=i,this.matDialog=t,this.componentsService=e,this.router=s,this.http=n,this.suscripciones$=new o.a,this.partidaEstadoSub$=new o.a,this.casillas=new Array(64).fill(null,0,64),this.piezasPartidaEstado=new Map,this.soyBlancas=!0,this.capturaSonido=new Audio("assets/captura.mp3"),this.movSonido=new Audio("assets/movimiento.mp3"),this.movimientoIndex=0,this.tiempoBlancas=0,this.tiempoNegras=0,this.orientacionRows=[7,6,5,4,3,2,1,0],this.orientacionColumns=[0,1,2,3,4,5,6,7],this.cargarObservables(),this.socketService.conectarSocket(),this.partidaInfo=this.router.getCurrentNavigation().extras.state,this.ingresoPorLink()}ngOnInit(){const a=this.router.events.pipe(Object(b.a)(a=>a instanceof n.b)).subscribe(a=>{const i=this.rout.snapshot.paramMap.get("id");this.socketService.emitirEvento("espectador",{entrar:!0,roomId:i}),this.temporizador&&(clearInterval(this.temporizador),this.temporizador=null)});this.suscripciones$.add(a)}ngOnDestroy(){this.suscripciones$.unsubscribe()}ingresoPorLink(){return Object(s.a)(this,void 0,void 0,function*(){try{if(!this.partidaInfo){const a=yield this.http.get(u.a+"/socketio/partidas").toPromise();this.partidasOnline.partidas=a.partidas}const a=this.rout.snapshot.paramMap.get("id");a&&20===a.length?this.socketService.socket.on("connect",()=>{this.socketService.emitirEvento("espectador",{entrar:!0,roomId:a})}):(this.componentsService.mostrarMensaje("La partida no fue encontrada",!0),this.cargarPartidas())}catch(a){}})}inicarTemporizador(){this.temporizador=setInterval(()=>this.movimientoIndex%2==0?this.tiempoBlancas--:this.tiempoNegras--,1e3)}cargarPartidas(){this.http.get(u.a+"/socketio/partidas").subscribe(a=>{this.partidasOnline.partidas=a.partidas})}infoJugador(a){return a&&this.perspectiva.checked?`Tiempo restante de ${this.partidaInfo.usernameNegras} \u23f3 ${this.tiempoRestante(this.tiempoNegras)}`:a&&!this.perspectiva.checked||!a&&this.perspectiva.checked?`Tiempo restante de ${this.partidaInfo.usernameBlancas} \u23f3 ${this.tiempoRestante(this.tiempoBlancas)}`:a||this.perspectiva.checked?void 0:`Tiempo restante de ${this.partidaInfo.usernameNegras} \u23f3 ${this.tiempoRestante(this.tiempoNegras)}`}cambiarPerspectiva(a){a?(this.orientacionRows=[7,6,5,4,3,2,1,0],this.orientacionColumns=[0,1,2,3,4,5,6,7]):(this.orientacionRows=[0,1,2,3,4,5,6,7],this.orientacionColumns=[7,6,5,4,3,2,1,0])}mostrarFinPartida(a){this.matDialog.open(m,{data:a,id:"espectador"}).afterClosed().subscribe(a=>{a&&this.cargarPartidas()})}cargarObservables(){const a=this.socketService.escucharEvento("partida-estado").subscribe(a=>{if(null!=a.encontrado)return this.componentsService.mostrarMensaje("La partida no fue encontrada",!0),void this.cargarPartidas();this.socketService.roomConectado=!0;const i=this.rout.snapshot.paramMap.get("id");this.partidaInfo||(this.partidaInfo=this.partidasOnline.partidas[this.partidasOnline.partidas.findIndex(a=>a.roomId===i)]),window.scrollTo({top:0,behavior:"smooth"}),this.movimientoIndex=a.movimientoIndex,this.tiempoBlancas=a.tiempoBlancas,this.tiempoNegras=a.tiempoNegras,this.casillas=new Array(64).fill(null,0,64),this.piezasPartidaEstado.clear(),a.piezas.forEach(a=>{this.piezasPartidaEstado.set(a[0],{casillaIndex:a[1].casillaIndex,unicode:this.piezaImagen(a[1].tipo,a[0]<=16),tipo:a[1].tipo}),this.casillas[a[1].casillaIndex]=a[0]}),0!==this.tiempoBlancas&&0!==this.tiempoNegras?this.inicarTemporizador():this.mostrarFinPartida("Partida terminada")});this.partidaEstadoSub$.add(a);const i=this.socketService.escucharEvento("evento-room").subscribe(a=>{this.aplicarEvento(a)},a=>{console.log("Error en listener ",a)});this.suscripciones$.add(i);const t=this.socketService.escucharEvento("status-partida").subscribe(a=>{switch(clearInterval(this.temporizador),this.temporizador=null,a.statusPartida){case r.a.JAQUE_MATE:this.mostrarFinPartida("Jaque-mate \ud83d\ude0e");break;case r.a.TABLAS:this.mostrarFinPartida("Tablas \ud83e\udd1d");break;case r.a.DESCONECCION:this.matDialog.getDialogById("espectador")||this.mostrarFinPartida("El jugador se desconecto \u2757\ufe0f");break;case r.a.RENDICION:this.mostrarFinPartida("El jugador se rindio \ud83c\udff3");break;case r.a.TIEMPO:this.mostrarFinPartida("Se le termino el tiempo al jugador \u231b\ufe0f");break;case r.a.ROOM_CERRADO:this.socketService.roomConectado=!1,this.componentsService.mostrarMensaje("Uno de los jugadores se salio");break;case r.a.REVANCHA:const i=this.matDialog.getDialogById("espectador");i&&i.close(),this.componentsService.mostrarMensaje("Los jugadores tendran una revancha");const t=this.partidaInfo.usernameBlancas;this.partidaInfo.usernameBlancas=this.partidaInfo.usernameNegras,this.partidaInfo.usernameNegras=t,this.piezasPartidaEstado=new Map([[1,{casillaIndex:0,tipo:c.a.TORRE,unicode:this.piezaImagen(c.a.TORRE,!0)}],[2,{casillaIndex:1,tipo:c.a.CABALLO,unicode:this.piezaImagen(c.a.CABALLO,!0)}],[3,{casillaIndex:2,tipo:c.a.ALFIL,unicode:this.piezaImagen(c.a.ALFIL,!0)}],[4,{casillaIndex:3,tipo:c.a.REINA,unicode:this.piezaImagen(c.a.REINA,!0)}],[5,{casillaIndex:4,tipo:c.a.REY,unicode:this.piezaImagen(c.a.REY,!0)}],[6,{casillaIndex:5,tipo:c.a.ALFIL,unicode:this.piezaImagen(c.a.ALFIL,!0)}],[7,{casillaIndex:6,tipo:c.a.CABALLO,unicode:this.piezaImagen(c.a.CABALLO,!0)}],[8,{casillaIndex:7,tipo:c.a.TORRE,unicode:this.piezaImagen(c.a.TORRE,!0)}],[9,{casillaIndex:8,tipo:c.a.PEON,unicode:this.piezaImagen(c.a.PEON,!0)}],[10,{casillaIndex:9,tipo:c.a.PEON,unicode:this.piezaImagen(c.a.PEON,!0)}],[11,{casillaIndex:10,tipo:c.a.PEON,unicode:this.piezaImagen(c.a.PEON,!0)}],[12,{casillaIndex:11,tipo:c.a.PEON,unicode:this.piezaImagen(c.a.PEON,!0)}],[13,{casillaIndex:12,tipo:c.a.PEON,unicode:this.piezaImagen(c.a.PEON,!0)}],[14,{casillaIndex:13,tipo:c.a.PEON,unicode:this.piezaImagen(c.a.PEON,!0)}],[15,{casillaIndex:14,tipo:c.a.PEON,unicode:this.piezaImagen(c.a.PEON,!0)}],[16,{casillaIndex:15,tipo:c.a.PEON,unicode:this.piezaImagen(c.a.PEON,!0)}],[17,{casillaIndex:48,tipo:c.a.PEON,unicode:this.piezaImagen(c.a.PEON,!1)}],[18,{casillaIndex:49,tipo:c.a.PEON,unicode:this.piezaImagen(c.a.PEON,!1)}],[19,{casillaIndex:50,tipo:c.a.PEON,unicode:this.piezaImagen(c.a.PEON,!1)}],[20,{casillaIndex:51,tipo:c.a.PEON,unicode:this.piezaImagen(c.a.PEON,!1)}],[21,{casillaIndex:52,tipo:c.a.PEON,unicode:this.piezaImagen(c.a.PEON,!1)}],[22,{casillaIndex:53,tipo:c.a.PEON,unicode:this.piezaImagen(c.a.PEON,!1)}],[23,{casillaIndex:54,tipo:c.a.PEON,unicode:this.piezaImagen(c.a.PEON,!1)}],[24,{casillaIndex:55,tipo:c.a.PEON,unicode:this.piezaImagen(c.a.PEON,!1)}],[25,{casillaIndex:56,tipo:c.a.TORRE,unicode:this.piezaImagen(c.a.TORRE,!1)}],[26,{casillaIndex:57,tipo:c.a.CABALLO,unicode:this.piezaImagen(c.a.CABALLO,!1)}],[27,{casillaIndex:58,tipo:c.a.ALFIL,unicode:this.piezaImagen(c.a.ALFIL,!1)}],[28,{casillaIndex:59,tipo:c.a.REINA,unicode:this.piezaImagen(c.a.REINA,!1)}],[29,{casillaIndex:60,tipo:c.a.REY,unicode:this.piezaImagen(c.a.REY,!1)}],[30,{casillaIndex:61,tipo:c.a.ALFIL,unicode:this.piezaImagen(c.a.ALFIL,!1)}],[31,{casillaIndex:62,tipo:c.a.CABALLO,unicode:this.piezaImagen(c.a.CABALLO,!1)}],[32,{casillaIndex:63,tipo:c.a.TORRE,unicode:this.piezaImagen(c.a.TORRE,!1)}]]),this.casillas=new Array(64).fill(null,0,64),this.piezasPartidaEstado.forEach((a,i)=>this.casillas[a.casillaIndex]=i),this.tiempoBlancas=60*a.tiempo,this.tiempoNegras=60*a.tiempo,this.inicarTemporizador()}},a=>{console.log("Error en el status partida ",a)});this.suscripciones$.add(t)}aplicarEvento(a){const i=this.movimientoIndex%2==0;switch(i?this.tiempoBlancas=a.movimiento.tiempoRestante:this.tiempoNegras=a.movimiento.tiempoRestante,this.movimientoIndex++,void 0===a.tipoJaquemate?a.tipo:a.tipoJaquemate){case r.a.JAQUE:case r.a.TABLAS:case r.a.MOVIMENTO:this.moverPieza(this.piezasPartidaEstado.get(a.movimiento.piezaId).casillaIndex,a.movimiento.casillaDestino);break;case r.a.CORONADO:const t=this.piezasPartidaEstado.get(a.movimiento.piezaId);this.moverPieza(t.casillaIndex,a.movimiento.casillaDestino),t.tipo=a.coronadoPieza,t.unicode=this.piezaImagen(a.coronadoPieza,i);break;case r.a.ENROQUE_CORTO:this.moverPieza(i?4:60,i?6:62),this.moverPieza(i?7:63,i?5:61);break;case r.a.ENROQUE_LARGO:this.moverPieza(i?4:60,i?2:58),this.moverPieza(i?0:56,i?3:59);break;case r.a.PEON_AL_PASO:this.moverPieza(this.piezasPartidaEstado.get(a.movimiento.piezaId).casillaIndex,a.movimiento.casillaDestino),this.casillas[this.piezasPartidaEstado.get(a.movimiento.comidaId).casillaIndex]=null,this.piezasPartidaEstado.delete(a.movimiento.comidaId),this.reproducirSonido(2)}}moverPieza(a,i){this.casillaVacia(i,this.casillas)?(this.casillas[i]=this.casillas[a],this.piezasPartidaEstado.get(this.casillas[a]).casillaIndex=i,this.casillas[a]=null,this.reproducirSonido(1)):(this.piezasPartidaEstado.delete(this.casillas[i]),this.reproducirSonido(2),this.casillas[i]=this.casillas[a],this.piezasPartidaEstado.get(this.casillas[a]).casillaIndex=i,this.casillas[a]=null)}reproducirSonido(a){return Object(s.a)(this,void 0,void 0,function*(){switch(a){case 1:yield this.movSonido.play();break;case 2:yield this.capturaSonido.play()}})}casillaVacia(a,i){return null==i[a]}tablaOrientacionRow(){const a=[0,1,2,3,4,5,6,7];return this.soyBlancas?a.reverse():a}tablaOrientacionColumn(){const a=[0,1,2,3,4,5,6,7];return this.soyBlancas?a:a.reverse()}casillaNegra(a,i){return i%2==0&&a%2==0||i%2!=0&&a%2!=0}getIndexByXY(a,i){return 8*i+a}getUnicode(a){return this.piezasPartidaEstado.get(a).unicode}piezaImagen(a,i){switch(a){case c.a.REY:return i?"\u2654":"\u265a";case c.a.REINA:return i?"\u2655":"\u265b";case c.a.TORRE:return i?"\u2656":"\u265c";case c.a.ALFIL:return i?"\u2657":"\u265d";case c.a.CABALLO:return i?"\u2658":"\u265e";case c.a.PEON:return i?"\u2659":"\u265f\ufe0e"}}tiempoRestante(a){const i=a%60;return`${Math.floor(a/60)}:${i<10?"0"+i:i}`}}return a.\u0275fac=function(i){return new(i||a)(l.Lb(n.a),l.Lb(p.a),l.Lb(d.b),l.Lb(I.a),l.Lb(n.c),l.Lb(O.a))},a.\u0275cmp=l.Fb({type:a,selectors:[["app-espectador"]],viewQuery:function(a,i){if(1&a&&(l.tc(v,!0),l.tc(g.a,!0)),2&a){let a;l.mc(a=l.Zb())&&(i.perspectiva=a.first),l.mc(a=l.Zb())&&(i.partidasOnline=a.first)}},decls:11,vars:5,consts:[[2,"text-align","center"],[1,"letraBlanca",2,"margin-left","auto","margin-right","auto","display","inline-block","margin-top","6px",3,"checked","change"],["perspectiva",""],["class","letraBlanca",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"partidasOnline"],[3,"cargado"],[1,"letraBlanca"],["class","pieza",4,"ngIf"],[1,"pieza"]],template:function(a,i){1&a&&(l.Rb(0,"div",0),l.Rb(1,"mat-slide-toggle",1,2),l.Yb("change",function(a){return i.cambiarPerspectiva(a.checked)}),l.yc(3," Perspectiva de jugador blancas"),l.Qb(),l.xc(4,f,2,1,"p",3),l.Qb(),l.Rb(5,"table"),l.xc(6,A,2,1,"tr",4),l.Qb(),l.xc(7,N,2,1,"p",3),l.Mb(8,"br"),l.Rb(9,"mat-card",5),l.Mb(10,"app-partidas-online",6),l.Qb()),2&a&&(l.Ab(1),l.ic("checked",!0),l.Ab(3),l.ic("ngIf",i.partidaInfo),l.Ab(2),l.ic("ngForOf",i.orientacionRows),l.Ab(1),l.ic("ngIf",i.partidaInfo),l.Ab(3),l.ic("cargado",!0))},directives:[P.a,e.l,e.k,E.a,g.a],styles:["table[_ngcontent-%COMP%]{border-collapse:collapse;border:1px solid #000;animation:randomColors 1s infinite}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(odd)   td[_ngcontent-%COMP%]:nth-child(odd), tr[_ngcontent-%COMP%]:nth-child(2n)   td[_ngcontent-%COMP%]:nth-child(2n){background:radial-gradient(#fff,hsla(0,0%,100%,.47843137254901963))}table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n)   td[_ngcontent-%COMP%]:nth-child(odd), tr[_ngcontent-%COMP%]:nth-child(odd)   td[_ngcontent-%COMP%]:nth-child(2n){background:radial-gradient(#5bbbff,rgba(0,0,0,.47843137254901963))}@keyframes randomColors{0%{border-color:red}25%{border-color:#00f}50%{border-color:green}75%{border-color:#ff0}to{border-color:purple}}.pieza[_ngcontent-%COMP%]{font-size:37px;margin:0;padding:0;text-align:center;width:auto;height:auto;-webkit-user-select:none;user-select:none}table[_ngcontent-%COMP%], td[_ngcontent-%COMP%], tr[_ngcontent-%COMP%]{width:50px;height:50px;white-space:nowrap}@media screen and (min-width:500px){table[_ngcontent-%COMP%]{width:500px;height:500px}.partidasOnline[_ngcontent-%COMP%], table[_ngcontent-%COMP%]{margin-right:auto;margin-left:auto}.partidasOnline[_ngcontent-%COMP%]{margin-top:10px;width:90%;background:#8ab9b5}}@media screen and (max-width:500px){table[_ngcontent-%COMP%]{width:100%;height:auto}.partidasOnline[_ngcontent-%COMP%]{margin-top:10px;width:95%;margin-left:auto;margin-right:auto;background:#8ab9b5}}[_nghost-%COMP%]{display:block;background:#81b0c3;height:100%;overflow:auto}.letraBlanca[_ngcontent-%COMP%]{color:#142857;font-weight:700;text-align:center;display:block}"]}),a})();var L=t("3JTg");const k=[{path:"",component:R},{path:":id",component:R}];let C=(()=>{class a{}return a.\u0275mod=l.Jb({type:a}),a.\u0275inj=l.Ib({factory:function(i){return new(i||a)},imports:[[e.b,n.e.forChild(k),d.d,P.b,L.a,E.c,h.b]]}),a})()}}]);